const { Telegraf, Markup } = require("telegraf");

const bot = new Telegraf("7592719498:AAF1-bj_rlVQrhsTJkNnmAHUnerLDLohYkI"); // ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯
const channelUsername = "@ztuwzu5eykfri5w4y"; // ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ú©Ø§Ù†Ø§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯

bot.start(async (ctx) => {
  const userId = ctx.from.id;

  try {
    // Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ú©Ø§Ù†Ø§Ù„
    const response = await ctx.telegram.getChatMember(channelUsername, userId);

    // ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø¹Ø¶ÙˆÛŒØª
    if (
      response.status === "member" ||
      response.status === "administrator" ||
      response.status === "creator"
    ) {
      // Ø§Ú¯Ø± Ø¹Ø¶Ùˆ Ø¨ÙˆØ¯ØŒ Ø§Ø¬Ø§Ø²Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª Ø±Ø§ Ø¨Ø¯Ù‡
      ctx.reply(
        "âœ… Ø´Ù…Ø§ Ø¹Ø¶Ùˆ Ú©Ø§Ù†Ø§Ù„ Ù‡Ø³ØªÛŒØ¯ØŒ Ø§Ø² Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø±Ø¨Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯!",
        Markup.keyboard([
          ["ğŸ’° Ù‚ÛŒÙ…Øª Ø¨ÛŒØª Ú©ÙˆÛŒÙ†", "ğŸ’° Ù‚ÛŒÙ…Øª Ù†Ø§ØªÚ©ÙˆÛŒÙ†"],
          ["âš½ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡"],
        ]).resize()
      );
    } else {
      // Ø§Ú¯Ø± Ø¹Ø¶Ùˆ Ù†Ø¨ÙˆØ¯ØŒ Ø¯Ú©Ù…Ù‡ Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¹Ø¶ÙˆÛŒØª Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯
      ctx.reply(
        "âŒ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§ØªØŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ Ø¹Ø¶Ùˆ Ú©Ø§Ù†Ø§Ù„ Ø´ÙˆÛŒØ¯.",
        Markup.inlineKeyboard([
          [
            Markup.button.url(
              "ğŸ“¢ Ø¹Ø¶ÙˆÛŒØª Ø¯Ø± Ú©Ø§Ù†Ø§Ù„",
              `https://t.me/${channelUsername.replace("@", "")}`
            ),
          ],
          [Markup.button.callback("ğŸ”„ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª", "check_membership")],
        ])
      );
    }
  } catch (error) {
    console.log("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª: ", error.message);
    ctx.reply(
      "âŒ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§ØªØŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ Ø¹Ø¶Ùˆ Ú©Ø§Ù†Ø§Ù„ Ø´ÙˆÛŒØ¯.",
      Markup.inlineKeyboard([
        [
          Markup.button.url(
            "ğŸ“¢ Ø¹Ø¶ÙˆÛŒØª Ø¯Ø± Ú©Ø§Ù†Ø§Ù„",
            `https://t.me/${channelUsername.replace("@", "")}`
          ),
        ],
        [Markup.button.callback("ğŸ”„ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª", "check_membership")],
      ])
    );
  }
});

// Ø¨Ø±Ø±Ø³ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¹Ø¶ÙˆÛŒØª ÙˆÙ‚ØªÛŒ Ú©Ø§Ø±Ø¨Ø± Ø±ÙˆÛŒ "ğŸ”„ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª" Ú©Ù„ÛŒÚ© Ú©Ù†Ø¯
bot.action("check_membership", async (ctx) => {
  const userId = ctx.from.id;

  try {
    const response = await ctx.telegram.getChatMember(channelUsername, userId);

    if (
      response.status === "member" ||
      response.status === "administrator" ||
      response.status === "creator"
    ) {
      ctx.reply(
        "âœ… Ø¹Ø¶ÙˆÛŒØª Ø´Ù…Ø§ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯! Ø§Ø² Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø±Ø¨Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",
        Markup.keyboard([
          ["ğŸ’° Ù‚ÛŒÙ…Øª Ø¨ÛŒØª Ú©ÙˆÛŒÙ†", "ğŸ’° Ù‚ÛŒÙ…Øª Ù†Ø§ØªÚ©ÙˆÛŒÙ†"],
          ["âš½ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡"],
        ]).resize()
      );
    } else {
      ctx.answerCbQuery("âŒ Ù‡Ù†ÙˆØ² Ø¹Ø¶Ùˆ Ú©Ø§Ù†Ø§Ù„ Ù†Ø´Ø¯Ù‡â€ŒØ§ÛŒØ¯!", { show_alert: true });
    }
  } catch (error) {
    console.log("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ù…Ø¬Ø¯Ø¯: ", error.message);
    ctx.answerCbQuery("âŒ Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯ØŒ Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯.", {
      show_alert: true,
    });
  }
});

bot.launch();
